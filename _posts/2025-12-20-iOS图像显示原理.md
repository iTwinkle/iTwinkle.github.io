---
layout: post
title: iOS图像显示原理
date: 2025-12-20
tag: iOS
---

### iOS图像显示原理

一、CPU 和 GPU
CPU 与 GPU 通过系统总线通信。CPU 负责图片解码、视图计算以及图层树的构建，并将位图数据或渲染指令提交给 Core Animation。Core Animation 在合适的时机将这些数据传输给 GPU，GPU 负责纹理采样、图层合成和像素渲染，并将最终结果写入帧缓冲区，由显示控制器按照屏幕刷新率显示到屏幕上。

1、CPU和GPU两个硬件是通过系统总线进行通信。
2、CPU 负责图片解码、视图计算以及图层树的构建，结果是位图（Bitmap）。
3、并将位图数据或渲染指令提交给 Core Animation。
4、GPU拿到位图后会做相应涂层的渲染和纹理的合成。
5、之后会把处理后的结果放到帧缓冲区（Frame Buffer）中。
6、然后由视频控制器显示到显示器中。

<img src="/images/posts/iOS图像显示原理/iOS图像显示原理1.jpg" > 

二、总体流程 （例如）
UIImage → CALayer.contents → Core Animation → GPU 渲染 → 屏幕显示

```
图片数据
 ↓
解码（CPU）
 ↓
位图（Bitmap）
 ↓
CALayer.contents
 ↓
Core Animation 合成
 ↓
GPU 渲染
 ↓
屏幕
```
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理3.jpg" > 
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理4.jpg" > 
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理5.jpg" > 
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理6.jpg" > 
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理7.jpg" > 

1、UIImage 本质是什么？

```
 UIImage ≠ 像素数据
 UIImage 本质是一个 图片描述对象：
    •   尺寸
    •   scale
    •   orientation
    •   底层引用 CGImage

    UIImage
 └── CGImageRef（真正的像素数据入口）
 ```
 📌 关键点

UIImage 本身并不直接保存“已经解码的位图”

<img src="/images/posts/iOS图像显示原理/iOS图像显示原理2.png" > 

二、图片解码（最关键、最容易卡顿）
1️⃣ 什么是解码？
    •   PNG / JPEG 是 压缩格式
    •   显示前必须变成 RGBA 位图
    •   解码发生在 CPU

2️⃣ 什么时候解码？

👉 第一次绘制到屏幕时

```
imageView.image = image;
// 并不一定立刻解码
```

真正触发解码的时机：
    •   drawRect:
    •   CALayer 提交到渲染管线
    •   Core Animation 准备 GPU 数据
三、UIImageView 如何显示图片？
 UIImageView 并不重写 drawRect
```
 UIImageView
 └── 内部直接设置 CALayer.contents
 ```

 关键流程

 ```
imageView.image = image;
↓
image.CGImage
↓
layer.contents = (__bridge id)image.CGImage;
↓
Core Animation
```

四、CALayer → Core Animation → GPU
1、CALayer 做了什么？
    不负责绘制
    •   负责：
    •   存储位图
    •   动画
    •   合成信息
2、Core Animation 管线
 ```
App（主线程）
 ↓ 提交 layer tree
Render Server（独立进程）
 ↓
GPU 合成
 ↓
屏幕
 ```
UIKit 只是在准备数据，真正显示由 GPU 完成

五、GPU 渲染阶段

GPU 主要做：
    •   纹理映射（Texture）
    •   图层合成（Composite）
    •   透明度混合
    •   Transform / Animation
<img src="/images/posts/iOS图像显示原理/iOS图像显示原理8.jpg" > 

<br>
转载请注明：[iTwinkle的博客](https://itwinkle.github.io/) » [iOS图像显示原理](http://iWolf.com/2025/12/iOS图像显示原理)  
   