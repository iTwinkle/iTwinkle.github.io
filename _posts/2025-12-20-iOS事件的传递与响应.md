---
layout: post
title: iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”
date: 2025-12-20
tag: iOS
---

### iOSäº‹ä»¶çš„ä¼ é€’

ä¸€ã€ä»€ä¹ˆæ˜¯ iOS çš„äº‹ä»¶ï¼Ÿ

åœ¨ UIKit ä¸­ï¼Œ**äº‹ä»¶ï¼ˆUIEventï¼‰**ä¸»è¦åŒ…æ‹¬ï¼š

<img src="/images/posts/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”1.jpg" > 

äºŒã€äº‹ä»¶ä»å“ªæ¥ï¼Ÿï¼ˆç³»ç»Ÿçº§æµç¨‹ï¼‰
1ã€äº‹ä»¶äº§ç”Ÿ
```
ç”¨æˆ·æ‰‹æŒ‡è§¦æ‘¸å±å¹•
â†“
ç¡¬ä»¶ï¼ˆè§¦æ‘¸å±ï¼‰
â†“
IOKit
â†“
SpringBoard
â†“
å½“å‰ App
â†“
UIApplication
```
2ã€UIApplication æ¥æ”¶äº‹ä»¶
```
- (void)sendEvent:(UIEvent *)event;
```
ç³»ç»Ÿåœ¨è¿™é‡ŒæŠŠäº‹ä»¶åˆ†å‘ç»™ UIWindow

<img src="/images/posts/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”2.png" >
ä¸‰ã€äº‹ä»¶ä¼ é€’ï¼ˆEvent Delivery / Hit-Testingï¼‰
1ã€â—äº‹ä»¶ä¼ é€’ = æ‰¾åˆ°â€œè°â€æ¥å¤„ç†è¿™ä¸ªäº‹ä»¶
æ ¸å¿ƒæ–¹æ³•é“¾ï¼ˆéå¸¸é‡è¦ï¼‰

```
- [UIWindow hitTest:withEvent:]
    â†“
- [UIView hitTest:withEvent:]
        â†“
- [UIView pointInside:withEvent:]
```
ä¼ªä»£ç ï¼š

```
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {

    // 1. è‡ªå·±ä¸èƒ½äº¤äº’ï¼Œç›´æ¥è¿”å› nil
    if (!self.userInteractionEnabled || self.hidden || self.alpha <= 0.01) {
        return nil;
    }

    // 2. ç‚¹ä¸åœ¨è‡ªå·±èŒƒå›´å†…
    if (![self pointInside:point withEvent:event]) {
        return nil;
    }

    // 3. ä»åå¾€å‰éå†å­è§†å›¾ï¼ˆz è½´ï¼‰
    for (UIView *subview in [self.subviews reverseObjectEnumerator]) {
        CGPoint subPoint = [subview convertPoint:point fromView:self];
        UIView *hitView = [subview hitTest:subPoint withEvent:event];
        if (hitView) {
            return hitView;
        }
    }

    // 4. å­è§†å›¾éƒ½æ²¡å¤„ç†ï¼Œè‡ªå·±å¤„ç†
    return self;
}
```
<img src="/images/posts/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”3.png" >

å‡ ä¸ªå¿…é‡ç‚¹
    â€¢   å­è§†å›¾ä»åå¾€å‰éå†ï¼ˆåæ·»åŠ çš„åœ¨ä¸Šå±‚ï¼‰
    â€¢   è¿”å›çš„ view å°±æ˜¯ äº‹ä»¶æœ€ç»ˆçš„å“åº”è€…
    â€¢   hidden / alpha / userInteractionEnabled ä¼šç›´æ¥å½±å“äº‹ä»¶ä¼ é€’

2ã€


1ã€hitTest:withEvent: åšäº†ä»€ä¹ˆï¼Ÿ
ä»æœ€å¤–å±‚è§†å›¾å¼€å§‹ï¼Œé€’å½’æŸ¥æ‰¾æœ€åˆé€‚çš„ View
```
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event;
```
 åˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨ View çš„ bounds å†…

 å¸¸è§ç”¨é€”ï¼š
    â€¢   æ‰©å¤§æŒ‰é’®ç‚¹å‡»åŒºåŸŸ
    â€¢   è‡ªå®šä¹‰ç‚¹å‡»çƒ­åŒº
```
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    CGRect bounds = CGRectInset(self.bounds, -20, -20);
    return CGRectContainsPoint(bounds, point);
}
```

### äº‹ä»¶å“åº”ï¼ˆResponder Chainï¼‰

â—äº‹ä»¶å“åº” = äº‹ä»¶â€œå¦‚ä½•â€è¢«å¤„ç†
UIResponder ä½“ç³»
```
UIView
UIViewController
UIWindow
UIApplication
```
å“åº”è€…é“¾ï¼ˆResponder Chainï¼‰
```
å½“å‰ View
â†“
çˆ¶ View
â†“
ViewController
â†“
UIWindow
â†“
UIApplication
```
<img src="/images/posts/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”4.png" >
1ã€touches æ–¹æ³•

```
- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event;
- (void)touchesMoved:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event;
- (void)touchesEnded:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event;
- (void)touchesCancelled:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event;
```
äº‹ä»¶å¤„ç†è§„åˆ™
    â€¢   è°å‘½ä¸­ï¼ˆhit-testï¼‰è°å…ˆæ”¶åˆ°
    â€¢   å¦‚æœå½“å‰ responder ä¸å¤„ç†ï¼ˆæ²¡å®ç° / è°ƒç”¨ superï¼‰
    â€¢   ğŸ‘‰ äº‹ä»¶ä¼šæ²¿ç€ å“åº”è€…é“¾å‘ä¸Šä¼ é€’
è°ƒç”¨ super çš„å½±å“
```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    // ä¸è°ƒç”¨ super
}
```
â—ç»“æœï¼š
    â€¢   äº‹ä»¶ ä¸ä¼šå†å¾€ä¸Šä¼ é€’
    â€¢   çˆ¶è§†å›¾ / VC æ¥æ”¶ä¸åˆ°äº‹ä»¶

### äº‹ä»¶ä¼ é€’ vs å“åº”ï¼ˆä¸€å¥è¯åŒºåˆ†ï¼‰
    â€¢   äº‹ä»¶ä¼ é€’ï¼šç³»ç»Ÿé€šè¿‡ hitTest æ‰¾åˆ°æœ€åˆé€‚çš„ View
    â€¢   äº‹ä»¶å“åº”ï¼šäº‹ä»¶æ²¿ç€ å“åº”è€…é“¾ è¢«å¤„ç†

<br>
è½¬è½½è¯·æ³¨æ˜ï¼š[iTwinkleçš„åšå®¢](https://itwinkle.github.io/) Â» [iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”](http://iWolf.com/2025/12/iOSäº‹ä»¶çš„ä¼ é€’ä¸å“åº”/)  
