---
layout: post
title: 代理-Delegate
date: 2025-12-23
tag: iOS
---

### 代理-Delegate
<img src="/images/posts/代理-Delegate/代理-Delegate2.jpg" > 
一、什么是代理（Delegate）

代理是一种 设计模式（Design Pattern），在 iOS 中主要用于实现对象间的 回调、事件传递和解耦合。
	•	核心思想：一个对象（被代理对象）不直接处理某些事情，而是把处理权交给另一个对象（代理对象）。
	•	目的：
	1.	降低耦合：被代理对象不需要知道谁来处理事件。
	2.	提供回调机制：当事件发生时通知外部对象。
	3.	自定义行为：允许外部对象实现不同的处理逻辑。

<img src="/images/posts/代理-Delegate/代理-Delegate.jpg" > 

二、代理的组成

代理模式一般由三部分组成：
	1.	协议（Protocol）
定义一组方法，代理对象需要实现这些方法。
Objective-C:
```
@protocol MyDelegate <NSObject>
- (void)didSomethingHappen;
@optional
- (void)didSomethingOptional;
@end
```
Swift:

```
protocol MyDelegate: AnyObject {
    func didSomethingHappen()
    func didSomethingOptional()  // Swift 不区分 @optional，需要用默认实现
}

extension MyDelegate {
    func didSomethingOptional() {} // 提供默认实现
}
```

2.	被代理对象（Delegator）
持有代理对象的引用，并在适当时机调用代理方法。
Objective-C:

```
@interface MyClass : NSObject
@property (nonatomic, weak) id<MyDelegate> delegate;
- (void)doSomething;
@end

@implementation MyClass
- (void)doSomething {
    // 触发事件
    if ([self.delegate respondsToSelector:@selector(didSomethingHappen)]) {
        [self.delegate didSomethingHappen];
    }
}
@end
```

Swift:

```
class MyClass {
    weak var delegate: MyDelegate?
    func doSomething() {
        delegate?.didSomethingHappen()
    }
}

```
<img src="/images/posts/代理-Delegate/代理-Delegate1.jpg" > 
⚠️ 注意：
	•	weak：避免循环引用。
	•	Objective-C 需要用 respondsToSelector: 检查可选方法是否实现。

3.	代理对象（Delegate）
遵守协议，并实现协议方法。
Objective-C:

```
@interface ViewController () <MyDelegate>
@end

@implementation ViewController
- (void)viewDidLoad {
    [super viewDidLoad];
    MyClass *obj = [[MyClass alloc] init];
    obj.delegate = self;
    [obj doSomething];
}

- (void)didSomethingHappen {
    NSLog(@"事件被回调");
}
@end
```

Swift:
```

class ViewController: UIViewController, MyDelegate {
    override func viewDidLoad() {
        super.viewDidLoad()
        let obj = MyClass()
        obj.delegate = self
        obj.doSomething()
    }
    func didSomethingHappen() {
        print("事件被回调")
    }
}
```

三、代理的特点
	1.	单一代理
一个对象通常只有一个代理，代理模式适用于单一回调场景。
	•	UITableView 的 delegate 就是单一代理。
	•	UITableView 的 dataSource 也是单一代理，但逻辑不同，专门提供数据。
	2.	弱引用
避免循环引用。Objective-C 中常用 weak，Swift 中也常用 weak 或 unowned。
	3.	解耦合
被代理对象不依赖具体类，只依赖协议。协议是一种“契约”。

四、代理 vs 通知 vs Block 回调
<img src="/images/posts/代理-Delegate/代理-Delegate3.jpg" > 

实际开发中：
	•	UITableView 使用代理。
	•	系统事件、模块间通知使用 NotificationCenter。
	•	网络请求完成、异步任务使用 Block 回调。


四、总结
	•	**代理（Delegate）**是 iOS 中最常用的设计模式之一，用于对象间的回调和解耦。
	•	核心要点：
	1.	定义协议（Protocol）
	2.	被代理对象持有代理引用并调用方法
	3.	代理对象实现协议并响应事件
	•	优点：降低耦合、清晰的事件回调机制、可扩展。
	•	注意事项：弱引用、可选方法、线程安全、单一代理限制。


<br>
转载请注明：[iTwinkle的博客](https://itwinkle.github.io/) » [代理-Delegate](http://iWolf.com/2025/12/代理-Delegate)  
   